<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SRT &amp; LRS Unpacked &mdash; From NAT to Live Streaming</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; background: #0a0e17; color: #c8d6e5; overflow-x: hidden; }

  .header { background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%); padding: 20px 30px; border-bottom: 1px solid #2a3040; }
  .header h1 { font-size: 22px; color: #e8ecf1; font-weight: 600; }
  .header h1 span { color: #4ecdc4; }

  .content { max-width: 1100px; margin: 0 auto; padding: 30px; }

  .section-label { font-size: 12px; color: #6b7b8d; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }

  /* collapsible (matches simulation tabs) */
  .desc-toggle { display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 10px 16px; background: #0d1117; border-radius: 8px; border-left: 3px solid #4ecdc4; margin-bottom: 4px; user-select: none; }
  .desc-toggle:hover { background: #111620; }
  .desc-toggle .arrow { font-size: 10px; color: #4ecdc4; transition: transform 0.2s; }
  .desc-toggle.open .arrow { transform: rotate(90deg); }
  .desc-toggle .toggle-title { font-size: 13px; font-weight: 600; color: #4ecdc4; }
  .desc-toggle .toggle-hint { font-size: 11px; color: #4a5568; margin-left: auto; }
  .desc-body { overflow: hidden; max-height: 0; transition: max-height 0.3s ease; }
  .desc-body.open { max-height: 2000px; }

  .sim-desc { font-size: 14px; color: #6b7b8d; line-height: 1.7; padding: 16px; background: #0d1117; border-radius: 8px; border-left: 3px solid #4ecdc4; }
  .sim-desc strong { color: #c8d6e5; }

  /* pipeline diagram */
  .diagram-wrapper { background: #0d1117; border-radius: 12px; border: 1px solid #1e2738; padding: 24px; margin-bottom: 24px; overflow-x: auto; }
  .pipeline { display: flex; gap: 20px; min-width: 700px; }
  .vpc-box { border: 1.5px solid #2a3040; border-radius: 12px; padding: 16px 20px; position: relative; }
  .vpc-box .vpc-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 14px; }
  .vpc-left { flex: 0 0 200px; display: flex; flex-direction: column; align-items: center; border-color: #1e3a5f; }
  .vpc-right { flex: 1; border-color: #3d2e0a; }
  .node-box { background: #161b26; border: 1px solid #2a3040; border-radius: 8px; padding: 10px 14px; text-align: center; }
  .node-box .node-name { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
  .node-box .node-sub { font-size: 11px; color: #4a5568; }
  .arrow-row { display: flex; align-items: center; gap: 0; margin: 12px 0; }
  .arrow-line { height: 2px; flex: 1; position: relative; }
  .arrow-line::after { content: ''; position: absolute; right: -1px; top: -4px; border: 5px solid transparent; border-left-width: 7px; }
  .arrow-label { font-size: 10px; padding: 3px 8px; border-radius: 4px; white-space: nowrap; font-weight: 600; }
  .arrow-sublabel { font-size: 10px; color: #4a5568; text-align: center; margin-top: 2px; }
  .lrs-paths { margin-top: 14px; }
  .path-row { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border: 1px solid #1e2738; border-radius: 8px; margin-bottom: 8px; background: #111620; }
  .path-row .path-label { font-size: 11px; font-weight: 700; color: #6b7b8d; flex-shrink: 0; min-width: 80px; }
  .path-row .path-arrow { color: #4ecdc4; font-size: 14px; flex-shrink: 0; }
  .path-row .path-node { font-size: 12px; font-weight: 600; padding: 4px 10px; border-radius: 6px; border: 1px solid; }
  .path-row .path-desc { font-size: 10px; color: #4a5568; }
  .pipe-note { font-size: 11px; color: #4a5568; line-height: 1.6; margin-top: 16px; padding-top: 12px; border-top: 1px solid #1e2738; }

  /* encapsulation box */
  .encap-box { background: #111620; border: 1px solid #1e2738; border-radius: 8px; padding: 16px 20px; margin-top: 16px; }
  .encap-pre { font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace; font-size: 12px; line-height: 1.8; color: #8899aa; white-space: pre; }

  /* terminology */
  .term-grid { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 16px; }
  .term-item { flex: 1; min-width: 200px; background: #111620; border: 1px solid #1e2738; border-radius: 8px; padding: 12px 16px; }
  .term-item .term-name { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
  .term-item .term-desc { font-size: 12px; color: #6b7b8d; line-height: 1.5; }

  /* learning path */
  .path-bar { display: flex; align-items: center; gap: 0; margin-bottom: 32px; flex-wrap: wrap; justify-content: center; }
  .step-card { flex: 0 1 240px; background: #111620; border: 1px solid #1e2738; border-radius: 10px; padding: 16px 20px; text-align: center; }
  .step-num { width: 32px; height: 32px; border-radius: 50%; border: 2px solid #4ecdc4; color: #4ecdc4; font-weight: 700; font-size: 14px; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 8px; }
  .step-title { font-size: 16px; font-weight: 700; color: #e8ecf1; }
  .step-layer { font-size: 11px; color: #6b7b8d; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }
  .step-q { font-size: 12px; color: #4ecdc4; margin-top: 8px; font-style: italic; }
  .step-arrow { color: #2a3040; font-size: 24px; padding: 0 12px; flex-shrink: 0; }

  /* simulation cards */
  .sim-cards { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 32px; }
  .sim-card { flex: 1; min-width: 280px; background: #111620; border: 1px solid #1e2738; border-radius: 12px; padding: 24px; text-decoration: none; color: inherit; transition: all 0.2s; display: block; position: relative; }
  .sim-card:hover { border-color: #4ecdc4; box-shadow: 0 0 20px rgba(78,205,196,0.08); transform: translateY(-2px); }
  .sim-card .badge { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
  .sim-card .card-title { font-size: 18px; font-weight: 700; color: #e8ecf1; margin-bottom: 10px; }
  .sim-card .card-desc { font-size: 13px; color: #6b7b8d; line-height: 1.6; margin-bottom: 12px; }
  .sim-card .card-tabs { font-size: 11px; color: #4a5568; line-height: 1.5; }
  .sim-card .card-tabs strong { color: #6b7b8d; }
  .sim-card .card-arrow { position: absolute; bottom: 16px; right: 20px; font-size: 18px; color: #2a3040; transition: color 0.2s; }
  .sim-card:hover .card-arrow { color: #4ecdc4; }

  /* Life of a Frame timeline */
  .frame-journey { position: relative; padding: 20px 0 20px 40px; margin-top: 16px; }
  .frame-journey::before { content: ''; position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, #4ecdc4, #4ecdc440); }
  .fj-stage { position: relative; margin-bottom: 24px; }
  .fj-stage:last-child { margin-bottom: 0; }
  .fj-dot { position: absolute; left: -33px; top: 12px; width: 28px; height: 28px; border-radius: 50%; border: 2px solid #4ecdc4; background: #0a0e17; color: #4ecdc4; font-size: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; z-index: 1; }
  .fj-card { background: #111620; border: 1px solid #1e2738; border-radius: 10px; padding: 16px 20px; }
  .fj-card-header { display: flex; align-items: baseline; gap: 10px; margin-bottom: 8px; flex-wrap: wrap; }
  .fj-component { font-size: 15px; font-weight: 700; color: #e8ecf1; }
  .fj-sublabel { font-size: 11px; color: #4a5568; text-transform: uppercase; letter-spacing: 0.5px; }
  .fj-desc { font-size: 13px; color: #6b7b8d; line-height: 1.7; margin-bottom: 12px; }
  .fj-desc strong { color: #c8d6e5; }
  .fj-desc code { font-family: 'SF Mono','Fira Code','Consolas',monospace; font-size: 12px; color: #4ecdc4; background: #1e2738; padding: 1px 5px; border-radius: 3px; }
  .fj-layers { font-family: 'SF Mono','Fira Code','Consolas',monospace; font-size: 11px; font-weight: 600; }
  .fj-layer { padding: 6px 10px; border-radius: 6px; border: 1px solid; margin-top: 4px; }
  .fj-layer-note { font-family: 'Segoe UI',system-ui,sans-serif; font-size: 10px; font-weight: 400; color: #4a5568; margin-left: 8px; }
  .fj-layer-ethernet { background: #1a1d24; border-color: #3a3f4a; color: #6b7b8d; }
  .fj-layer-ip { background: #161a2a; border-color: #2a3060; color: #6c8cff; }
  .fj-layer-udp-srt { background: #0d1f1e; border-color: #1a4040; color: #4ecdc4; }
  .fj-layer-mpegts { background: #1f1a0d; border-color: #403a1a; color: #f9ca24; }
  .fj-layer-video { background: #1a0d0d; border-color: #401a1a; color: #ff6b6b; }
  .fj-layer-stripped { opacity: 0.3; text-decoration: line-through; border-style: dashed; }
  .fj-action { display: inline-block; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; padding: 2px 8px; border-radius: 4px; margin-top: 8px; }
  .fj-action-nat { color: #ff6b6b; background: #2a1215; border: 1px solid #5c2020; }
  .fj-action-arq { color: #00b894; background: #0a1f1a; border: 1px solid #0a3d2e; }
  .fj-action-internal { color: #6c8cff; background: #121630; border: 1px solid #1e3a5f; }
  .desc-body-tall.open { max-height: 8000px; transition: max-height 0.5s ease; }

  /* footnote */
  .footnote { font-size: 13px; color: #8899aa; line-height: 1.7; padding: 16px 20px; background: #111620; border-radius: 8px; border: 1px solid #1e2738; margin-bottom: 24px; }
  .footnote strong { color: #c8d6e5; }

  /* footer */
  .footer { background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%); padding: 16px 30px; border-top: 1px solid #2a3040; text-align: center; font-size: 12px; color: #4a5568; }

  @media (max-width: 700px) {
    .path-bar { flex-direction: column; align-items: stretch; }
    .step-arrow { transform: rotate(90deg); text-align: center; padding: 4px 0; }
    .sim-cards { flex-direction: column; }
    .frame-journey { padding-left: 30px; }
    .fj-dot { left: -25px; width: 22px; height: 22px; font-size: 10px; }
    .frame-journey::before { left: 10px; }
    .fj-card { padding: 12px 14px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1><span>SRT &amp; LRS Unpacked</span> &mdash; From NAT to Live Streaming</h1>
</div>

<div class="content">

  <!-- Introduction -->
  <div class="desc-toggle" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open');this.querySelector('.toggle-hint').textContent=this.classList.contains('open')?'click to collapse':'click to expand';">
    <span class="arrow">&#9654;</span>
    <span class="toggle-title">About These Simulations</span>
    <span class="toggle-hint">click to expand</span>
  </div>
  <div class="desc-body">
    <div class="sim-desc" style="margin-bottom:24px;">
      These interactive simulations explain the protocols behind <strong>live video transport</strong> in the VOS 360 / LRS pipeline. An <strong>SRT source</strong> pushes compressed video (H.264/H.265) over the public internet into an <strong>LRS Cloud Source</strong> (ingress), where the live feed is received and stabilised. From there, <strong>LRS</strong> routes the stream directly to a <strong>VOS 360</strong> cluster for transcoding &mdash; or via a <strong>Cloud Edge</strong> (egress) when the cluster is in a different GCP region.
      <br><br>
      Each simulation lets you manipulate network conditions and watch protocol behavior in real time. The goal: <strong>understand NAT traversal on the first hop, why TCP isn't suitable for live video, and how SRT delivers broadcast-quality streams over unpredictable networks.</strong>
    </div>
  </div>

  <!-- Pipeline Diagram -->
  <div class="section-label" style="margin-top:24px;">The VOS 360 / LRS Pipeline</div>
  <div class="diagram-wrapper">
    <div class="pipeline">
      <!-- Customer VPC -->
      <div class="vpc-box vpc-left">
        <div class="vpc-label" style="color:#6c8cff;">Customer GCP VPC</div>
        <div class="node-box" style="border-color:#1e3a5f;">
          <div class="node-name" style="color:#4ecdc4;">SRT Source</div>
          <div class="node-sub">Encoder: H.264 / H.265</div>
          <div class="node-sub" style="color:#4ecdc4; margin-top:4px;">SRT Caller</div>
        </div>
      </div>

      <!-- Arrow: Customer → LRS -->
      <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;flex:0 0 90px;">
        <div style="font-size:20px;color:#4ecdc4;">&#10132;</div>
        <div class="arrow-label" style="color:#ff6b6b;background:#2a1215;border:1px solid #5c2020;">NAT</div>
        <div class="arrow-sublabel">Public internet</div>
        <div class="arrow-sublabel">UDP datagrams</div>
      </div>

      <!-- Harmonic LRS (Live Routing Service) -->
      <div class="vpc-box vpc-right">
        <div class="vpc-label" style="color:#f9ca24;">LRS &mdash; Live Routing Service <span style="color:#4a5568;font-weight:400;text-transform:none;">(Harmonic cloud)</span></div>
        <div style="display:flex;gap:14px;align-items:flex-start;flex-wrap:wrap;">
          <!-- LRS Cloud Source -->
          <div class="node-box" style="border-color:#3d2e0a;flex:0 0 160px;">
            <div class="node-name" style="color:#f9ca24;">Cloud Source</div>
            <div class="node-sub" style="color:#f9ca24;">Ingress (Pipe)</div>
            <div class="node-sub">SRT Listener</div>
            <div class="node-sub" style="margin-top:4px;font-size:10px;color:#4a5568;line-height:1.4;">Receives &amp; stabilises<br>the live feed</div>
          </div>

          <div style="display:flex;flex-direction:column;justify-content:center;align-self:center;flex-shrink:0;">
            <div style="font-size:16px;color:#4ecdc4;">&#10132;</div>
          </div>

          <!-- Two destination paths -->
          <div style="flex:1;min-width:280px;">
            <!-- Path 1: Same region -->
            <div class="path-row" style="border-color:#0a3d2e;">
              <div class="path-label" style="color:#00b894;">Same region</div>
              <div class="path-arrow">&#10132;</div>
              <div class="path-node" style="color:#00b894;border-color:#0a3d2e;background:#0a1f1a;">VOS 360 Cluster</div>
              <div class="path-desc">Ingest &amp; Transcode</div>
            </div>
            <!-- Path 2: Cross-region via Edge -->
            <div class="path-row" style="border-color:#3d2e0a;">
              <div class="path-label" style="color:#f9ca24;">Cross-region</div>
              <div class="path-arrow">&#10132;</div>
              <div class="path-node" style="color:#f9ca24;border-color:#3d2e0a;background:#1f1a0a;">Cloud Edge</div>
              <div class="path-arrow">&#10132;</div>
              <div class="path-node" style="color:#00b894;border-color:#0a3d2e;background:#0a1f1a;">VOS 360</div>
              <div class="path-desc">Different GCP region</div>
            </div>
            <div style="font-size:10px;color:#4a5568;padding:2px 12px;line-height:1.4;">Cloud Edge (egress) is created close to the consuming VOS cluster's region to minimise latency.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- LRS Glossary -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:14px;margin-bottom:4px;">
      <div style="flex:1;min-width:200px;background:#111620;border:1px solid #1e2738;border-radius:8px;padding:10px 14px;">
        <div style="font-size:12px;font-weight:700;color:#f9ca24;margin-bottom:4px;">LRS <span style="font-weight:400;color:#4a5568;">(Live Routing Service)</span></div>
        <div style="font-size:11px;color:#6b7b8d;line-height:1.5;">The overall cloud routing platform. Manages ingest points, egress points, admission control, access tokens, routing, and redundancy.</div>
      </div>
      <div style="flex:1;min-width:200px;background:#111620;border:1px solid #1e2738;border-radius:8px;padding:10px 14px;">
        <div style="font-size:12px;font-weight:700;color:#f9ca24;margin-bottom:4px;">Cloud Source <span style="font-weight:400;color:#4a5568;">(LRS Source / Pipe)</span></div>
        <div style="font-size:11px;color:#6b7b8d;line-height:1.5;">Ingress side of LRS. Exposes an SRT ingress URL where the encoder pushes the live feed. Receives, stabilises, and makes the stream available downstream.</div>
      </div>
      <div style="flex:1;min-width:200px;background:#111620;border:1px solid #1e2738;border-radius:8px;padding:10px 14px;">
        <div style="font-size:12px;font-weight:700;color:#f9ca24;margin-bottom:4px;">Cloud Edge <span style="font-weight:400;color:#4a5568;">(LRS Edge)</span></div>
        <div style="font-size:11px;color:#6b7b8d;line-height:1.5;">Egress side of LRS. Exposes an SRT egress URL that downstream systems (VOS clusters, etc.) connect to. Sits close to the consuming cluster's region.</div>
      </div>
    </div>

    <div class="pipe-note">
      Each arrow = an SRT connection carrying UDP datagrams inside IP packets.<br>
      Only the first hop (Customer &rarr; LRS Cloud Source) crosses the public internet and requires NAT traversal.
    </div>

    <!-- Caller/Listener footnote -->
    <div class="desc-toggle" style="margin-top:12px;border-left-color:#f9ca24;" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open');this.querySelector('.toggle-hint').textContent=this.classList.contains('open')?'click to collapse':'click to expand';">
      <span class="arrow">&#9654;</span>
      <span class="toggle-title" style="color:#f9ca24;">Why is the SRT Source a Caller and LRS Cloud Source a Listener?</span>
      <span class="toggle-hint">click to expand</span>
    </div>
    <div class="desc-body">
      <div style="font-size:13px;color:#6b7b8d;line-height:1.8;padding:16px;background:#0d1117;border-radius:8px;border-left:3px solid #f9ca24;">

        <strong style="color:#ff6b6b;">The NAT problem</strong><br>
        The SRT Source sits behind the customer's NAT gateway (corporate firewall or cloud NAT in their GCP VPC). NAT blocks all <strong style="color:#c8d6e5;">unsolicited inbound traffic</strong> &mdash; if no device inside the network initiated a connection first, packets arriving from outside are silently dropped.

        <br><br>
        <strong style="color:#c8d6e5;">SRT Source must be the Caller</strong><br>
        The encoder initiates an outbound SRT handshake to the LRS Cloud Source's public IP and port. This outbound packet passes through the customer's NAT, which creates a <strong style="color:#4ecdc4;">mapping (pinhole)</strong>: <code style="font-family:'SF Mono','Fira Code','Consolas',monospace;font-size:12px;color:#4ecdc4;background:#1e2738;padding:1px 5px;border-radius:3px;">internal IP:port &harr; external IP:port</code>. LRS Cloud Source responds, and NAT recognises the response as return traffic for the existing mapping &mdash; so it lets it through. Bidirectional SRT communication is now established through the NAT pinhole.

        <br><br>
        <strong style="color:#c8d6e5;">LRS Cloud Source can be the Listener</strong><br>
        The LRS Cloud Source is also inside a VPC (Harmonic's LRS VPC in GCP) &mdash; so it has NAT/firewall too. The difference is how it's configured:

        <div style="display:flex;gap:12px;margin:12px 0;flex-wrap:wrap;">
          <div style="flex:1;min-width:220px;background:#111620;border:1px solid #1e2738;border-radius:6px;padding:10px 12px;">
            <div style="font-size:11px;font-weight:700;color:#ff6b6b;margin-bottom:4px;">Customer's NAT</div>
            <div style="font-size:11px;color:#6b7b8d;line-height:1.5;">
              <strong style="color:#c8d6e5;">Dynamic, many-to-one</strong> &mdash; hundreds of internal IPs share a few external IPs.<br>
              Inbound traffic is <strong style="color:#ff6b6b;">blocked</strong> unless an outbound connection created the pinhole first.<br>
              <span style="color:#4ecdc4;">&#8594; Must be Caller</span>
            </div>
          </div>
          <div style="flex:1;min-width:220px;background:#111620;border:1px solid #1e2738;border-radius:6px;padding:10px 12px;">
            <div style="font-size:11px;font-weight:700;color:#f9ca24;margin-bottom:4px;">LRS Cloud Source</div>
            <div style="font-size:11px;color:#6b7b8d;line-height:1.5;">
              <strong style="color:#c8d6e5;">Static, 1:1 mapping</strong> &mdash; dedicated public IP mapped permanently to the VM (or via a Network Load Balancer).<br>
              Firewall rules <strong style="color:#00b894;">allow inbound UDP</strong> on the SRT port. No outbound connection needed first.<br>
              <span style="color:#4ecdc4;">&#8594; Can be Listener</span>
            </div>
          </div>
        </div>

        <strong style="color:#c8d6e5;">Inside the Harmonic cloud</strong> (Cloud Source &rarr; VOS 360, or Cloud Source &rarr; Cloud Edge), there is no NAT between the components &mdash; it's all within VPC or cross-region peering. Caller/Listener assignment there is an operational choice, not a NAT constraint.
      </div>
    </div>
  </div>

  <!-- Packet Encapsulation -->
  <div class="section-label">What Travels Inside Each SRT Hop</div>
  <div class="encap-box">
    <div class="encap-pre"><span class="teal">Compressed Video Frame</span> <span class="muted">(H.264/H.265 NAL units / MPEG-TS)</span>
  <span class="white">&#9492;&#9472;</span> <span class="yellow">L4:</span> SRT Datagram <span class="muted">(UDP + SRT header, ~1316 bytes payload = 7 x 188 TS pkts)</span>
      <span class="white">&#9492;&#9472;</span> <span class="blue">L3:</span> IP Packet <span class="muted">(src/dst IP &mdash; NAT rewrites source address here)</span>
          <span class="white">&#9492;&#9472;</span> <span class="muted">L2:</span> Ethernet Frame <span class="muted">(MAC addresses, changes at every router hop)</span></div>
  </div>

  <!-- Life of a Frame -->
  <div class="desc-toggle" style="margin-top:16px;" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open');this.querySelector('.toggle-hint').textContent=this.classList.contains('open')?'click to collapse':'click to expand';">
    <span class="arrow">&#9654;</span>
    <span class="toggle-title">Life of a Frame &mdash; From Camera to Transcoder</span>
    <span class="toggle-hint">click to expand</span>
  </div>
  <div class="desc-body desc-body-tall">
    <div style="padding:16px;background:#0d1117;border-radius:8px;border-left:3px solid #4ecdc4;">
      <div style="font-size:12px;color:#6b7b8d;margin-bottom:16px;line-height:1.6;">
        Follow a single encoded video frame as it travels from the camera through NAT, across the public internet, into LRS Cloud Source, and finally to VOS 360 for transcoding. At each stage, watch the encapsulation layers being added or removed.
      </div>

      <div class="frame-journey">

        <!-- Stage 1: Encoder -->
        <div class="fj-stage">
          <div class="fj-dot">1</div>
          <div class="fj-card">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#4ecdc4;">Encoder (SRT Source)</span>
              <span class="fj-sublabel">Camera &rarr; Compressed Frame</span>
            </div>
            <div class="fj-desc">
              Camera captures a raw frame. The encoder compresses it into <strong>H.264/H.265 NAL units</strong>, then packetizes those NAL units into <strong>MPEG-TS packets</strong> &mdash; 7 &times; 188 bytes = <strong>1,316 bytes</strong> of payload, ready for transport.
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-mpegts">
                MPEG-TS &nbsp;(7 &times; 188 B = 1,316 B)
                <div class="fj-layer fj-layer-video">
                  H.264/H.265 NAL Units <span class="fj-layer-note">&larr; compressed video frame</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stage 2: SRT Encapsulation -->
        <div class="fj-stage">
          <div class="fj-dot">2</div>
          <div class="fj-card">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#4ecdc4;">SRT Encapsulation</span>
              <span class="fj-sublabel">Wrapping for Transport</span>
            </div>
            <div class="fj-desc">
              The MPEG-TS payload is wrapped in an <strong>SRT datagram</strong> (SRT header added over UDP), placed inside an <strong>IP packet</strong> with source/destination addresses, then wrapped in an <strong>Ethernet frame</strong> with MAC addresses for the first hop.
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-ethernet">
                L2: Ethernet &nbsp; src=<span style="color:#f9ca24;">AA:...:AA</span> &nbsp; dst=<span style="color:#f9ca24;">BB:...:BB</span>
                <span class="fj-layer-note">&larr; next-hop MAC (gateway)</span>
                <div class="fj-layer fj-layer-ip">
                  L3: IP &nbsp; src=<span style="color:#6c8cff;">10.0.1.5</span> &nbsp; dst=<span style="color:#6c8cff;">34.100.2.8</span>
                  <div class="fj-layer fj-layer-udp-srt">
                    L4: SRT/UDP &nbsp; src port=<span style="color:#4ecdc4;">5000</span> &nbsp; dst port=<span style="color:#4ecdc4;">9000</span>
                    <div class="fj-layer fj-layer-mpegts">
                      MPEG-TS (1,316 B)
                      <div class="fj-layer fj-layer-video">
                        H.264/H.265 NAL Units
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stage 3: Customer NAT -->
        <div class="fj-stage">
          <div class="fj-dot">3</div>
          <div class="fj-card" style="border-left:3px solid #ff6b6b;">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#ff6b6b;">Customer NAT</span>
              <span class="fj-sublabel">Address Rewrite</span>
            </div>
            <div class="fj-desc">
              NAT gateway rewrites the source IP from <code>10.0.1.5</code> to the public address <code>203.0.113.50</code> and remaps the source port. A <strong>NAT mapping</strong> is created so return traffic can find its way back. The Ethernet frame is rebuilt for the next hop.
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-ethernet">
                L2: Ethernet &nbsp; src=<span style="color:#f9ca24;">CC:...:CC</span> &nbsp; dst=<span style="color:#f9ca24;">DD:...:DD</span>
                <span class="fj-layer-note">&larr; NEW MACs for next hop</span>
                <div class="fj-layer fj-layer-ip">
                  L3: IP &nbsp; src=<span style="color:#ff6b6b;text-decoration:line-through;">10.0.1.5</span> &rarr; <span style="color:#ff6b6b;font-weight:700;">203.0.113.50</span> &nbsp; dst=<span style="color:#6c8cff;">34.100.2.8</span>
                  <span class="fj-layer-note">&larr; NAT rewrites source</span>
                  <div class="fj-layer fj-layer-udp-srt">
                    L4: SRT/UDP &nbsp; src port=<span style="color:#ff6b6b;text-decoration:line-through;">5000</span> &rarr; <span style="color:#ff6b6b;font-weight:700;">41234</span> &nbsp; dst port=<span style="color:#4ecdc4;">9000</span>
                    <div class="fj-layer fj-layer-mpegts">
                      MPEG-TS (1,316 B) <span class="fj-layer-note">&larr; unchanged</span>
                      <div class="fj-layer fj-layer-video">H.264/H.265 NAL Units</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="fj-action fj-action-nat">NAT Mapping: 10.0.1.5:5000 &harr; 203.0.113.50:41234</div>
          </div>
        </div>

        <!-- Stage 4: Public Internet -->
        <div class="fj-stage">
          <div class="fj-dot">4</div>
          <div class="fj-card">
            <div class="fj-card-header">
              <span class="fj-component">Public Internet</span>
              <span class="fj-sublabel">Multiple Router Hops</span>
            </div>
            <div class="fj-desc">
              The packet traverses multiple routers across the internet. At each hop, the <strong>Ethernet frame is stripped and rebuilt</strong> with new MAC addresses. The <strong>IP addresses stay the same</strong> &mdash; they are the end-to-end addressing that routers use for forwarding decisions.
            </div>
            <div class="fj-layers">
              <div style="font-size:11px;color:#4a5568;font-family:'SF Mono','Fira Code','Consolas',monospace;line-height:2;">
                <div><span style="color:#6b7b8d;">Hop 1:</span> Ethernet <span style="color:#f9ca24;">CC&rarr;DD</span> &nbsp;|&nbsp; IP <span style="color:#6c8cff;">203.0.113.50 &rarr; 34.100.2.8</span></div>
                <div><span style="color:#6b7b8d;">Hop 2:</span> Ethernet <span style="color:#f9ca24;">EE&rarr;FF</span> &nbsp;|&nbsp; IP <span style="color:#6c8cff;">203.0.113.50 &rarr; 34.100.2.8</span> <span style="color:#00b894;">&larr; same</span></div>
                <div><span style="color:#6b7b8d;">Hop 3:</span> Ethernet <span style="color:#f9ca24;">GG&rarr;HH</span> &nbsp;|&nbsp; IP <span style="color:#6c8cff;">203.0.113.50 &rarr; 34.100.2.8</span> <span style="color:#00b894;">&larr; same</span></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Stage 5: LRS Cloud Source -->
        <div class="fj-stage">
          <div class="fj-dot">5</div>
          <div class="fj-card" style="border-left:3px solid #f9ca24;">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#f9ca24;">LRS Cloud Source (Ingress)</span>
              <span class="fj-sublabel">Receive &amp; Stabilise</span>
            </div>
            <div class="fj-desc">
              Outer layers are peeled off: Ethernet stripped, IP unwrapped, UDP extracted. The <strong>SRT layer</strong> takes over: checks packet sequence numbers, places the datagram into the <strong>TSBPD buffer</strong> at its correct timestamp position, and triggers <strong>ARQ (NAK-based retransmission)</strong> if any packets were lost in transit. The stream is stabilised and ready for internal delivery.
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-ethernet fj-layer-stripped">L2: Ethernet &mdash; stripped</div>
              <div class="fj-layer fj-layer-ip fj-layer-stripped">L3: IP &mdash; unwrapped</div>
              <div class="fj-layer fj-layer-udp-srt fj-layer-stripped">L4: UDP &mdash; extracted</div>
              <div class="fj-layer fj-layer-udp-srt">
                SRT Layer: seq check, TSBPD buffer, ARQ recovery
                <div class="fj-layer fj-layer-mpegts">
                  MPEG-TS (1,316 B) <span class="fj-layer-note">&larr; extracted &amp; buffered</span>
                  <div class="fj-layer fj-layer-video">H.264/H.265 NAL Units</div>
                </div>
              </div>
            </div>
            <div class="fj-action fj-action-arq">SRT: TSBPD + ARQ Recovery</div>
          </div>
        </div>

        <!-- Stage 6: LRS → VOS 360 -->
        <div class="fj-stage">
          <div class="fj-dot">6</div>
          <div class="fj-card" style="border-left:3px solid #6c8cff;">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#6c8cff;">LRS &rarr; VOS 360 (within VPC)</span>
              <span class="fj-sublabel">Internal Re-encapsulation</span>
            </div>
            <div class="fj-desc">
              The stream is re-encapsulated for delivery within Harmonic's VPC: new <strong>SRT datagram</strong>, new <strong>UDP/IP headers</strong> (internal VPC addresses), new <strong>Ethernet frame</strong>. No NAT is involved &mdash; both components are on the same VPC or connected via VPC peering.
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-ethernet">
                L2: Ethernet &nbsp; <span style="color:#6b7b8d;">(VPC internal MACs)</span>
                <div class="fj-layer fj-layer-ip">
                  L3: IP &nbsp; src=<span style="color:#6c8cff;">10.128.0.5</span> &nbsp; dst=<span style="color:#6c8cff;">10.128.0.20</span>
                  <span class="fj-layer-note">&larr; internal VPC addresses</span>
                  <div class="fj-layer fj-layer-udp-srt">
                    L4: SRT/UDP &nbsp; <span style="color:#4ecdc4;">new SRT session</span>
                    <div class="fj-layer fj-layer-mpegts">
                      MPEG-TS (1,316 B)
                      <div class="fj-layer fj-layer-video">H.264/H.265 NAL Units</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="fj-action fj-action-internal">No NAT &mdash; VPC Internal</div>
          </div>
        </div>

        <!-- Stage 7: VOS 360 Transcoder -->
        <div class="fj-stage">
          <div class="fj-dot">7</div>
          <div class="fj-card" style="border-left:3px solid #00b894;">
            <div class="fj-card-header">
              <span class="fj-component" style="color:#00b894;">VOS 360 Transcoder (Ingest)</span>
              <span class="fj-sublabel">Decapsulate &amp; Decode</span>
            </div>
            <div class="fj-desc">
              All transport layers are stripped off. The <strong>MPEG-TS packets</strong> are extracted and demuxed. The <strong>H.264/H.265 NAL units</strong> are decoded back into a raw video frame and delivered to the transcoder for processing (ABR ladder generation, packaging for HLS/DASH delivery).
            </div>
            <div class="fj-layers">
              <div class="fj-layer fj-layer-ethernet fj-layer-stripped">L2: Ethernet &mdash; stripped</div>
              <div class="fj-layer fj-layer-ip fj-layer-stripped">L3: IP &mdash; stripped</div>
              <div class="fj-layer fj-layer-udp-srt fj-layer-stripped">L4: SRT/UDP &mdash; stripped</div>
              <div class="fj-layer fj-layer-mpegts">
                MPEG-TS &mdash; demuxed
                <div class="fj-layer fj-layer-video">
                  H.264/H.265 NAL Units &rarr; <strong style="color:#00b894;">Decoded Raw Frame</strong>
                  <span class="fj-layer-note">&larr; delivered to transcoder</span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Terminology -->
  <div class="term-grid">
    <div class="term-item">
      <div class="term-name" style="color:#6c8cff;">Segment <span style="color:#4a5568;">= TCP (Layer 4)</span></div>
      <div class="term-desc">TCP's data unit. Carries seq/ack numbers for reliable, ordered delivery. <strong style="color:#6c8cff;">See TCP Simulation</strong></div>
    </div>
    <div class="term-item">
      <div class="term-name" style="color:#4ecdc4;">Datagram <span style="color:#4a5568;">= UDP/SRT (Layer 4)</span></div>
      <div class="term-desc">UDP's data unit. No built-in reliability &mdash; SRT adds its own on top. <strong style="color:#4ecdc4;">See SRT Simulation</strong></div>
    </div>
    <div class="term-item">
      <div class="term-name" style="color:#f9ca24;">Packet <span style="color:#4a5568;">= IP (Layer 3)</span></div>
      <div class="term-desc">The routable unit. NAT rewrites source IP/port at this layer. <strong style="color:#f9ca24;">See NAT Simulation</strong></div>
    </div>
    <div class="term-item">
      <div class="term-name" style="color:#6b7b8d;">Frame <span style="color:#4a5568;">= Ethernet (Layer 2)</span></div>
      <div class="term-desc">Hop-by-hop delivery. MAC addresses change at every router; IP addresses don't (except NAT).</div>
    </div>
  </div>

  <!-- Frame / MAC explanation -->
  <div class="desc-toggle" style="margin-top:8px;border-left-color:#6b7b8d;" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open');this.querySelector('.toggle-hint').textContent=this.classList.contains('open')?'click to collapse':'click to expand';">
    <span class="arrow">&#9654;</span>
    <span class="toggle-title" style="color:#6b7b8d;">Why do MAC addresses change at every hop but IP addresses don't?</span>
    <span class="toggle-hint">click to expand</span>
  </div>
  <div class="desc-body">
    <div style="font-size:13px;color:#6b7b8d;line-height:1.8;padding:16px;background:#0d1117;border-radius:8px;border-left:3px solid #6b7b8d;">

      <strong style="color:#c8d6e5;">IP addresses = end-to-end (the postal address)</strong><br>
      The source and destination IP addresses stay the <strong style="color:#c8d6e5;">same</strong> for the entire journey. Every router reads the destination IP to decide where to forward the packet next. The only exception is NAT, which rewrites the source IP.

      <br><br>
      <strong style="color:#c8d6e5;">MAC addresses = hop-by-hop (the delivery driver)</strong><br>
      Ethernet frames only work between <strong style="color:#c8d6e5;">directly connected devices</strong> (on the same wire or switch). At every router, the incoming Ethernet frame is stripped off and a <strong style="color:#4ecdc4;">new one</strong> is created with the router's own MAC as source and the next hop's MAC as destination.

      <br><br>
      <strong style="color:#c8d6e5;">Example &mdash; SRT Source to LRS Cloud Source:</strong>
      <div style="font-family:'SF Mono','Fira Code','Consolas',monospace;font-size:11px;line-height:1.7;background:#111620;border:1px solid #1e2738;border-radius:6px;padding:12px 14px;margin:10px 0;overflow-x:auto;white-space:pre;">SRT Source <span style="color:#4a5568;">(MAC: AA)</span>  &rarr;  Router1 <span style="color:#4a5568;">(MAC: BB, CC)</span>  &rarr;  Router2 <span style="color:#4a5568;">(MAC: DD, EE)</span>  &rarr;  LRS <span style="color:#4a5568;">(MAC: FF)</span>

<span style="color:#4ecdc4;">Hop 1:</span>  Ethernet: <span style="color:#f9ca24;">src=AA  dst=BB</span>    IP: <span style="color:#4ecdc4;">src=10.0.1.5  dst=34.100.2.8</span>
        <span style="color:#4a5568;">&uarr; "deliver to Router1"</span>          <span style="color:#4a5568;">&uarr; "ultimately going to LRS"</span>

<span style="color:#4ecdc4;">Hop 2:</span>  Ethernet: <span style="color:#f9ca24;">src=CC  dst=DD</span>    IP: <span style="color:#4ecdc4;">src=10.0.1.5  dst=34.100.2.8</span>
        <span style="color:#ff6b6b;">&uarr; NEW MACs (router's own)</span>      <span style="color:#00b894;">&uarr; SAME IPs (unchanged)</span>

<span style="color:#4ecdc4;">Hop 3:</span>  Ethernet: <span style="color:#f9ca24;">src=EE  dst=FF</span>    IP: <span style="color:#4ecdc4;">src=10.0.1.5  dst=34.100.2.8</span>
        <span style="color:#ff6b6b;">&uarr; NEW MACs again</span>              <span style="color:#00b894;">&uarr; STILL the same IPs</span></div>

      <strong style="color:#c8d6e5;">In short:</strong> IP addresses are the <strong style="color:#4ecdc4;">postal address</strong> on the envelope (stays the same end-to-end). MAC addresses are the <strong style="color:#f9ca24;">delivery driver</strong> handing it off at each stop (changes every hop). Routers bridge these local Ethernet segments together to form the internet.
    </div>
  </div>

  <!-- Learning Path -->
  <div class="section-label" style="margin-top:32px;">Recommended Learning Path</div>
  <div class="path-bar">
    <div class="step-card">
      <div class="step-num">1</div>
      <div class="step-title">NAT</div>
      <div class="step-layer">Layer 3 &mdash; Network</div>
      <div class="step-q">"How does the SRT source reach LRS through NAT?"</div>
    </div>
    <div class="step-arrow">&#10132;</div>
    <div class="step-card">
      <div class="step-num">2</div>
      <div class="step-title">TCP</div>
      <div class="step-layer">Layer 4 &mdash; Transport</div>
      <div class="step-q">"Why not just use TCP for video transport?"</div>
    </div>
    <div class="step-arrow">&#10132;</div>
    <div class="step-card">
      <div class="step-num">3</div>
      <div class="step-title">SRT</div>
      <div class="step-layer">Layer 4 &mdash; over UDP</div>
      <div class="step-q">"How SRT delivers broadcast-quality video"</div>
    </div>
  </div>

  <!-- Simulation Cards -->
  <div class="section-label">Interactive Simulations</div>
  <div class="sim-cards">

    <a class="sim-card" href="nat-simulation.html" style="border-left: 3px solid #f9ca24;">
      <div class="badge" style="color:#f9ca24;">Layer 3 &mdash; Network</div>
      <div class="card-title">NAT / SRT / LRS</div>
      <div class="card-desc">How SRT sources connect to an LRS Cloud Source through NAT. See Caller/Listener roles, public internet vs cloud-internal routing, and the full VOS 360 / LRS pipeline.</div>
      <div class="card-tabs"><strong>4 tabs:</strong> Packet Flow &bull; NAT Types &bull; SRT Through NAT &bull; VOS 360 / LRS</div>
      <div class="card-arrow">&#10132;</div>
    </a>

    <a class="sim-card" href="tcp-simulation.html" style="border-left: 3px solid #6c8cff;">
      <div class="badge" style="color:#6c8cff;">Layer 4 &mdash; Transport</div>
      <div class="card-title">TCP Fundamentals</div>
      <div class="card-desc">Why TCP's reliability model breaks live video &mdash; head-of-line blocking, retransmission delays, congestion backoff. Then see TCP vs UDP side-by-side.</div>
      <div class="card-tabs"><strong>5 tabs:</strong> 3-Way Handshake &bull; Transmission &amp; ACK &bull; Retransmission &bull; SACK &amp; Limitations &bull; TCP vs UDP</div>
      <div class="card-arrow">&#10132;</div>
    </a>

    <a class="sim-card" href="srt-simulation.html" style="border-left: 3px solid #00b894;">
      <div class="badge" style="color:#00b894;">Layer 4 &mdash; Transport (over UDP)</div>
      <div class="card-title">SRT Protocol</div>
      <div class="card-desc">How SRT delivers broadcast-quality video: timestamp-based delivery (TSBPD), NAK-based retransmission (ARQ), and clock drift correction.</div>
      <div class="card-tabs"><strong>3 tabs:</strong> TSBPD Packet Delivery &bull; ARQ Retransmission &bull; Clock Drift</div>
      <div class="card-arrow">&#10132;</div>
    </a>

  </div>

  <!-- Footnote -->
  <div class="footnote">
    <strong>Why terminology matters:</strong> When streaming engineers say "packet loss," they typically mean loss at Layer 3 (IP packets dropped by congested routers). But SRT operates at Layer 4 &mdash; it sends UDP datagrams containing SRT-framed data, encapsulated inside IP packets. The "packets" in the SRT simulation are technically UDP datagrams inside IP packets. The distinction matters when diagnosing issues &mdash; a network engineer checking router queues sees IP packets, while <code style="font-family:'SF Mono','Fira Code','Consolas',monospace;font-size:12px;color:#4ecdc4;background:#1e2738;padding:1px 5px;border-radius:3px;">srt-live-transmit</code> statistics report SRT-level datagram loss.
  </div>

</div>

<div class="footer">
  Built for streaming engineers learning live video transport
</div>

</body>
</html>
